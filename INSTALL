Installation instructions
=========================

1. enable the extension; clear all caches (at least the ini and template caches)


For performance logging
-----------------------

2. edit ezperformancelogger.ini to decide the data you want to log:
   parameter [GeneralSettings]/TrackVariables
   See file README for more details avout available data
   NB: db_queies logging only works with ez debug on


3. edit ezperformancelogger.ini to decide how to log it:

  a. using Apache
  to add perf data to the Apache access log, customize your Apache configuration
  taking as example the sample_httpd.conf file in the doc directory.
  It is recommended not to enable collection of execution time via
  TrackVariables when using Apache, but to rely on the more precise native
  measure obtained with %D
  Remember to restart Apache after changing its configuration

  b. using piwik or google analytics
  the perf data is logged directly to the analytics engine database, via usage
  of "custom variables" (ie. we add the perf data to the js call done for visit
  tracking). For both these tools, you will need to insert in your pagelayout
  template the standard javascript tracking code; the extension will transform
  it as appropriate to add the extra data.
  For ga, only the async tag is supported.
  NB: data reported via piwik or google analytics will not be accurate if your
  website is using a caching reverse proxy or cdn. Please use tha apache-log
  configuration in such case.

  c. using a separate log file
  this is useful if your webserver is Nginx, Lighttpd or IIS. In that case, the
  extension can log perf data all by itself to a separate log. The name of that
  file has to be configured in ezperformancelogger.ini; it can be written either
  using the same format as Apache "extended" log, with perf counters data at the
  end of the line, or in csv format


4. once logging of data is active, we recommend using a tool like httrack or
   wget to scan your complete website and get an overview of the performance
   of your web pages and identify the most resource-hungry ones.

   A good idea is to run the scan both with eZ Publish caches on and off, to
   measure the effectiveness of cache configuration.

   NB: the extension does not provide any means to visualize the logged data.
   You can use any tool from excel to matlab for that.


For profiling
-------------

1. make sure the XHProf PECL extension is installed and active

2. give to the user account that will be used for viewing profiling data permissions
   to execute hxprof/view

3. edit your config.php file and add the following lines at the top:
   (if you miss the config.php file, copy config.php-RECOMMENDED into config.php)

   include( 'extension/ezperformancelogger/classes/ezxhproflogger.php' );
   eZXHProfLogger::start();

   in alternative, you can start profiling from anywhere in your php code

4. edit design.ini in extension/ezperformacelogger/settings, and uncomment the
   lines corresponding to your eZ version

5. view any website page: a link to its profiling info is at the bottom of the debug output

6. in the Admin Interface, in the Setup tab, you will find a link to a page listing
   all available profiling data for viewing.

7. all profiling data is stored permanently on disk, in var/log/xhprof. To avoid
   filling the hard-disk, please schedule execution of the removexhprofdata cronjob
